title: Yarn-æ¨¡å—ç®¡ç†å·¥å…·
date: 2017-01-11 19:39:50
banner: https://future-team.github.io/blog-resources/imgs/yarn/banner_yarn.jpg
thumbnail: https://future-team.github.io/blog-resources/imgs/yarn/banner_yarn.jpg
tags: 
- Yarn
- NPM
- å·¥å…·
- é™ˆå°é¥¼
---

### ç®€ä»‹
2016å¹´10æœˆ11æ—¥ï¼Œfacebookå‘å¸ƒæ–°çš„æ¨¡å—ç®¡ç†å·¥å…·Yarnã€‚   
éšç€NPMçš„å¹¿æ³›ä½¿ç”¨ä¸­ï¼Œå¼€å§‹å‡ºç°å®‰å…¨æ€§å’Œæ€§èƒ½ä¸è¶³çš„é—®é¢˜ï¼Œå¦‚ï¼š

-   å®‰è£…é€Ÿåº¦æ…¢ï¼ˆè™½ç„¶æ·˜å®NPMé•œåƒè§£å†³äº†å›½å†…ä¸‹è½½æ…¢çš„ç°è±¡ï¼Œä½†æ˜¯ä¸å¯å¦è®¤ä½¿ç”¨NPMå®‰è£…æ…¢çš„é—®é¢˜ï¼‰ã€‚
-   å…è®¸å®‰è£…packagesæ—¶æ‰§è¡Œä»£ç ï¼ŒåŸ‹ä¸‹å®‰å…¨éšæ‚£ã€‚
-   å®‰è£…packagesçš„ç‰ˆæœ¬ä¸å¤Ÿç¨³å®šç­‰ã€‚

ä¸ºå¼¥è¡¥å­˜åœ¨éƒ¨åˆ†ç¼ºé™·çš„NPMï¼Œfacebookå’ŒExponentã€Googleå’ŒTildeä¸€èµ·æ‰“é€ NPMçš„æ›¿ä»£ç‰ˆæœ¬Yarnã€‚
<!-- more -->

### Yarn vs NPM
#### yarn.lock
NPMå’ŒYarnéƒ½æ˜¯é€šè¿‡package.jsonæ‹‰å–ä¾èµ–çš„æ¨¡å—ï¼Œä»¥ä¸‹æ˜¯æ‹‰å–æ¨¡å—çš„ç‰ˆæœ¬å·è§„åˆ™ï¼ˆä»¥1.2.2ä¸ºä¾‹ï¼‰ï¼š

-   æŒ‡å®šç‰ˆæœ¬å·ï¼ˆ1.2.2ï¼‰ï¼šåªå®‰è£…æŒ‡å®šç‰ˆæœ¬
-   æ³¢æµªå·ï¼‹ç‰ˆæœ¬å·ï¼ˆ~1.2,2ï¼‰ï¼šå®‰è£…1.2.xçš„æœ€æ–°ç‰ˆæœ¬ï¼ˆä¸ä½äº1.2.2ï¼‰
-   æ’å…¥å·ï¼‹ç‰ˆæœ¬å·ï¼ˆ^1.2.2ï¼‰ï¼šå®‰è£…1.x.xçš„æœ€æ–°ç‰ˆæœ¬ï¼ˆä¸ä½äº1.2.2ï¼‰

å½“æ‰§è¡Œ`npm install [package] --save`æ—¶ï¼Œé»˜è®¤saveçš„æ˜¯æ’å…¥å·çš„æ–¹å¼ï¼Œè¡¨ç¤ºå½“å‰çš„æ¨¡å—è‡³å¤šæ˜¯å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ–°å¢æˆ–é—®é¢˜ä¿®æ­£ã€‚è™½ç„¶èƒ½å¤Ÿæ‰‹åŠ¨æ”¹æˆå®‰è£…æŒ‡å®šç‰ˆæœ¬çš„æ–¹å¼ï¼Œä½†ä¹Ÿä¸èƒ½ç¡®å®šå½“å‰æ¨¡å—ä¾èµ–çš„æ¨¡å—æ˜¯å¦æ˜¯å›ºå®šçš„ï¼Œä¹Ÿå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¨¡å—éƒ½èƒ½æŒ‰ç…§è¿™æ ·çš„æ–¹å¼æ¥æ›´æ–°å‘å¸ƒï¼Œå› æ­¤æ¯æ¬¡å®‰è£…éƒ½æœ‰å¯èƒ½ä¼šæ‹‰å–åˆ°ä¸€ä»½ç‰ˆæœ¬ä¸å›ºå®šçš„æ¨¡å—ï¼Œè¿™ä¸ªä¸ç¨³å®šæ€§æ˜¯ä¸€ä¸ªæå¤§çš„éšæ‚£ã€‚

yarn.locké”å®šæ–‡ä»¶è§£å†³äº†ä»¥ä¸Šçš„é—®é¢˜ï¼Œåœ¨æ‰§è¡Œyarnå®‰è£…å‘½ä»¤æ—¶è‡ªåŠ¨ç”Ÿæˆï¼Œç¡®åˆ‡çš„è®°å½•å®‰è£…æ¨¡å—çš„ç‰ˆæœ¬å·ã€‚åŒæ ·NPMä¸­å­˜åœ¨ç›¸ä¼¼çš„`npm-shrinkwrap.json`ï¼Œéœ€è¦é€šè¿‡æ‰§è¡Œ `npm shrinkwrap` æ‰‹åŠ¨ç”Ÿæˆã€‚å¯¹æ¯”ä¹‹ä¸‹åœ¨æ•°æ®æ ¼å¼ä¸Šyarn.lockæ›´ä¸ºç²¾ç®€æ¸…æ™°ã€‚

#### æ›´å¿«çš„æ¨¡å—ä¸‹è½½
yarnä¸‹è½½æ—¶ä¼šè¿›è¡Œæ›´å¥½çš„æ’åºï¼Œæœ€å¤§é™åº¦çš„æé«˜ç½‘ç»œåˆ©ç”¨ç‡ï¼Œä¸”å®‰è£…è¿‡ç¨‹ä¸­å¦‚æœç½‘ç»œè¯·æ±‚å¤±è´¥ä¼šè¿›è¡Œè‡ªåŠ¨é‡è¯•ã€‚

ä»¥ä¸‹è½½gruntä¸ºä¾‹ï¼Œyarnè€—æ—¶13.52sï¼ŒNPMç¬¬ä¸€æ¬¡å°è¯•è¶…è¿‡ä¸€åˆ†é’Ÿï¼Œå†æ¬¡å°è¯•åœ¨40så·¦å³ã€‚ï¼ˆä»¥ä¸Šæ•°æ®è·Ÿå½“å‰ç½‘ç»œçŠ¶å†µæœ‰ç›¸å¯¹å¯†åˆ‡å…³ç³»ï¼Œä¸ºå¢åŠ å®éªŒå¯ä¿¡åº¦ï¼Œåœ¨å¤šæ¬¡å°è¯•ä¸åŒçš„æ¨¡å—çš„ä¹‹åï¼Œyarnéƒ½æœ‰ç›¸å¯¹ä¼˜å¼‚çš„ä¸‹è½½é€Ÿåº¦ï¼‰

é™¤æ­¤ï¼Œyarnè¿˜æ”¯æŒç¦»çº¿ä¸‹è½½ï¼Œå‰ææ˜¯ä¹‹å‰ä¸‹è¿‡è¿™ä¸ªåŒ…ã€‚

å¯¹äºå®‰è£…ä¸€æ•´ä¸ªé¡¹ç›®yarnçš„é€Ÿåº¦è¿˜æ˜¯éœ€è¦æå‡ï¼Œä½†æ˜¯åŒæ ·ä¹Ÿå¯ä»¥ç»™yarnè®¾ç½®å®‰è£…æºï¼š
```code
$ yarn config set registry 'https://registry.npm.taobao.org'
```

#### æ›´ç®€æ´çš„è¾“å‡º
yarnçš„è¾“å‡ºä¿¡æ¯æ·»åŠ äº†ä¸€äº›emojiè¡¨æƒ…ğŸ˜„ï¼Œä¿¡æ¯ç®€å•æ˜äº†ï¼ŒNPMçš„è¾“å‡ºç›¸å¯¹å†—é•¿ã€‚

æ›´å¤šä¿¡æ¯ï¼š[migrating-from-npm](https://yarnpkg.com/en/docs/migrating-from-npm)


### ä½¿ç”¨
#### å®‰è£…
```code
// ç”¨Homebrewå®‰è£…
$ brew update
$ brew install yarn

// ç”¨NPMå®‰è£…
$ npm install yarn -g
```

#### CLI
##### å®‰è£…ä¾èµ–
å®‰è£…package.jsonçš„ä¾èµ–
```code
$ yarn
or
$ yarn install
```

æœ¬åœ°å®‰è£…æŸä¸ªæ¨¡å—ä¾èµ–
```code
$ yarn add [package] 
->$ npm install [package] --save

$ yarn add [package] [--dev/-D]
->$ npm install --save-dev [package]
```

å…¨å±€å®‰è£…
```code
$ yarn global add [package]
->$ npm install [--global/-g] [package]
```

##### åˆ é™¤ä¾èµ–
```code
$ yarn remove [package]
->$ npm uninstall --save [package]
```

##### å‡çº§ä¾èµ–
æ ¹æ®package.jsonæ–‡ä»¶é‡æ–°å®‰è£…åˆ°å½“å‰é…ç½®çš„æœ€æ–°ç‰ˆæœ¬
```code
$ yarn upgrade
->$ rm -rf node_modules && npm install
```

æ›´å¤šä¸NPMçš„CLIå¯¹æ¯”ï¼š[cli-commands-comparison](https://yarnpkg.com/en/docs/migrating-from-npm#toc-cli-commands-comparison)
æ›´å¤šCLIä»‹ç»ï¼š[cli-introduction](https://yarnpkg.com/en/docs/cli/)

### å…¶ä»–
æé†’ä¸€ä¸‹ï¼Œå½“å¼€å§‹ä½¿ç”¨yarnè¦è®°å¾—å°†yarn.lockæ–‡ä»¶ä¸€èµ·æ”¾è¿›ä»£ç ä»“åº“ä¸­åˆ†äº«ç»™å°ä¼™ä¼´ï¼Œè¿™æ˜¯å‡†ç¡®å®‰è£…çš„ä¿è¯ã€‚

### æ€»ç»“
å¥½åƒä¸€æ•´ç¯‡æ–‡ç« éƒ½åœ¨èµæ‰¬yarnè´¬ä½NPMï¼Œä½†æ˜¯ä¸€ä¸ªä¸œè¥¿åšå‡ºæ¥è¦è®©å¤§ä¼—æ¥å—åŠ¿å¿…è¦æ¯”å‰è€…æ›´åŠ ä¼˜ç§€ã€‚NPMçš„å¼ºå¤§éƒ½è§è¯†è¿‡äº†ï¼Œä½†é—®é¢˜ä¹Ÿæ˜¯æ¥è¸µè€Œè‡³ï¼Œyarnå¯¹æ­¤åšäº†å¾ˆå¤šçš„æ”¹å–„ï¼Œä½†æ˜¯ç›®å‰çœ‹åˆ°yarnçš„issueä¹Ÿæ˜¯ä¸æ–­ï¼Œæ¯•ç«Ÿæ˜¯æ–°ä¸œè¥¿ï¼Œè¿˜éœ€è¦æ—¶é—´çš„æ²‰æ·€ğŸ˜„ã€‚

